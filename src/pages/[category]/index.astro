---
import "../../styles.css";
import BaseLayout from "../../layouts/BaseLayout.astro";
import assets from "../../assets.json";

import IndexTemplate from "../../templates/IndexTemplate.astro";

export async function getStaticPaths() {
  const paths = [];
  for (const [catKey, cat] of Object.entries(assets)) {
    paths.push({
      params: { category: catKey },
      props: {
        category: catKey,
      },
    });
  }
  return paths;
}

const { category } = Astro.props;
const cat = assets[category];
const title = cat.title_key
  ? cat.title_key.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase())
  : category.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase());

const items = cat.items.map((item) => ({
  href: `/${category}/${item.key}`,
  imgSrc: `/${item.file}`,
  imgAlt: item.description ?? item.key,
  title: item.key,
  buttonText: "Zobacz",
  description: item.description ?? cat.description,
}));
---

<BaseLayout title={title} description={cat.description} bodyClass="bg-base-200">
  <main class="flex-1 flex flex-col pt-0 bg-base-200 min-h-0">
    <IndexTemplate
      items={items}
      headerImgSrc={cat.header
        ? `/${cat.header.replace(/\.[^/.]+$/, "")}.png`
        : undefined}
      headerImgAlt={cat.header ? `${title} header` : undefined}
    />
  </main>
</BaseLayout>
