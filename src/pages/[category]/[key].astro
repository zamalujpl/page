---
import "../../styles.css";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import PrintFooter from "../../components/PrintFooter.astro";
import assets from "../../assets.json";
import Head from "../../components/Head.astro";
import Sidebar from "../../components/Sidebar.astro";

function getCategoryObjectKey(categoryParam) {
  // Find the object key matching the categoryParam (which may be a title_key)
  for (const [objectKey, cat] of Object.entries(assets)) {
    if (objectKey === categoryParam) return objectKey;
    if (cat.title_key === categoryParam) return objectKey;
  }
  return categoryParam;
}

/** Generate static paths for all images in all categories */
export async function getStaticPaths() {
  const paths = [];
  for (const [catKey, cat] of Object.entries(assets)) {
    for (const item of cat.items) {
      paths.push({
        params: { category: catKey, key: item.key },
        props: {
          image: item,
          category: catKey,
          catTitle: cat.title_key ?? catKey,
        },
      });
    }
  }
  return paths;
}

const { category, key } = Astro.props;
const { image } = Astro.props;
const objectKey = getCategoryObjectKey(category);
const cat = assets[objectKey];
const catTitle = cat.title_key;
const title = image.key
  .replace(/_/g, " ")
  .replace(/\b\w/g, (l) => l.toUpperCase());
const year = new Date().getFullYear();
---

<html lang="en" data-theme="light">
  <Head title={title} />
  <body
    class="font-sans text-base-content flex flex-col min-h-screen bg-base-100"
  >
    <Navbar />
    <div class="flex flex-row flex-1 w-full">
      <Sidebar />
      <main
        class="flex flex-col items-center justify-center bg-base-100 flex-1"
      >
        <div
          id="print-area"
          class="w-full max-w-2xl flex flex-col items-center bg-base-100"
        >
          <img
            src={`/${image.file}`}
            alt={title}
            id="main-image"
            class="max-w-full max-h-[80vh] mb-6"
          />
          <PrintFooter />
        </div>
        <button
          onclick="window.print()"
          class="no-print btn btn-outline btn-primary btn-sm mb-8"
        >
          Drukuj obrazek
        </button>
        <a
          href={`/${objectKey}/`}
          class="no-print text-primary hover:underline"
        >
          Powr√≥t do kategorii {catTitle}
        </a>
      </main>
    </div>
    <Footer />
  </body>
</html>
